<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>System Data - The Specs Book</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Introduction into ECS and the Specs API.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="01_intro.html"><strong>1.</strong> Introduction</a></li><li><a href="02_hello_world.html"><strong>2.</strong> Hello World</a></li><li><a href="03_dispatcher.html"><strong>3.</strong> Dispatcher</a></li><li><a href="04_resources.html"><strong>4.</strong> Resources</a></li><li><a href="05_storages.html"><strong>5.</strong> Storages</a></li><li><a href="06_system_data.html" class="active"><strong>6.</strong> System Data</a></li><li><a href="07_join.html"><strong>7.</strong> Joining components</a></li><li><a href="08_parallel_join.html"><strong>8.</strong> Parallel Join</a></li><li><a href="09_rendering.html"><strong>9.</strong> Rendering</a></li><li><strong>10.</strong> Building a game with Specs</li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">The Specs Book</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="06_system_data.html#draft-system-data" id="draft-system-data"><h1>[DRAFT] System Data</h1></a>
<p>Every system can request data which it needs to run. This data can be specified
using the <code>System::SystemData</code> type. Typical implementors of the <code>SystemData</code> trait
are <code>ReadStorage</code>, <code>WriteStorage</code>, <code>Fetch</code>, <code>FetchMut</code> and <code>Entities</code>.
A tuple of types implementing <code>SystemData</code> automatically also implements <code>SystemData</code>.
This means you can specify your <code>System::SystemData</code> as follows:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
struct Sys;

impl&lt;'a&gt; System&lt;'a&gt; for Sys {
    type SystemData = (WriteStorage&lt;'a, Pos&gt;, ReadStorage&lt;'a, Vel&gt;);
    
    fn run(&amp;mut self, (pos, vel): Self::SystemData) {
        /* ... */
    }
}
#}</code></pre></pre>
<p>It is very important that you don't fetch both a <code>ReadStorage</code> and a <code>WriteStorage</code>
for the same component or a <code>Fetch</code> and a <code>FetchMut</code> for the same resource.
This is just like the borrowing rules of Rust, where you can't borrow something
mutably and immutably at the same time. In Specs, we have to check this at
runtime, thus you'll get a panic if you don't follow this rule.</p>
<a class="header" href="06_system_data.html#accessing-entities" id="accessing-entities"><h2>Accessing Entities</h2></a>
<p>You want to create/delete entities from a system? There is
good news for you. You can just use <code>Entities</code> to do that.
It implements <code>SystemData</code> so just put it in your <code>SystemData</code> tuple.</p>
<blockquote>
<p>Don't confuse <code>specs::Entities</code> with <code>specs::EntitiesRes</code>.
While the latter one is the actual resource, the former one is a type
definition for <code>Fetch&lt;Entities&gt;</code>.</p>
</blockquote>
<p>Please note that you may never write to these <code>Entities</code>, so only
use <code>Fetch</code>. Even though it's immutable, you can atomically create
and delete entities with it. Just use the <code>.create()</code> and <code>.delete()</code>
methods, respectively. After dynamic entity creation / deletion,
a call <code>World::maintain</code> is necessary in order to make the changes
persistent and delete associated components.</p>
<p><strong>When joining over entities, you need to dereference <code>Fetch</code>
and re-reference the returned <code>EntitiesRes</code>.</strong></p>
<a class="header" href="06_system_data.html#adding-and-removing-components" id="adding-and-removing-components"><h2>Adding and removing components</h2></a>
<p>Adding or removing components can be done by modifying
either components storage directly with a <code>WriteStorage</code>
or lazily using the <code>LazyUpdate</code> resource.</p>
<pre><code class="language-rust ignore">use specs::{Component, Fetch, LazyUpdate, NullStorage, System, Entities, WriteStorage};

struct Stone;
impl Component for Stone {
    type Storage = NullStorage&lt;Self&gt;;
}

struct StoneCreator;
impl&lt;'a&gt; System&lt;'a&gt; for StoneCreator {
    type SystemData = (
        Entities&lt;'a&gt;,
        WriteStorage&lt;'a, Stone&gt;,
        Fetch&lt;'a, LazyUpdate&gt;,
    );

    fn run(&amp;mut self, (entities, stones, updater): Self::SystemData) {
        let stone = entities.create();

        // 1) Either we insert the component by writing to its storage
        stones.insert(stone, Stone);

        // 2) or we can lazily insert it with `LazyUpdate`
        updater.insert(stone, Stone);
    }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> After using <code>LazyUpdate</code> a call to <code>World::maintain</code>
is necessary to actually execute the changes.</p>
</blockquote>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="05_storages.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="07_join.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="05_storages.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="07_join.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
